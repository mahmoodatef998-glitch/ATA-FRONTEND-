# โ ุชุญููู ุงูุฃูุงู - ุญุฐู Code Duplication

**ุงูุชุงุฑูุฎ:** ุฏูุณูุจุฑ 2024

---

## ๐ฏ ุงูุฅุฌุงุจุฉ ุงููุฎุชุตุฑุฉ

**ูุงุ ุญุฐู ุงูุชูุฑุงุฑุงุช ูู ูุคุซุฑ ุณูุจูุงู ุนูู ุงููุดุฑูุน. ุจู ุณูููู ูููุฏุงู ุฌุฏุงู!**

---

## โ ููุงุฐุง ูู ูุคุซุฑ ุณูุจูุงูุ

### 1. **ุงูู Utility Functions ููุฌูุฏุฉ ูุชุนูู ุจุงููุนู**

**ุงููููุงุช ุงูููุฌูุฏุฉ:**
- โ `lib/error-handler.ts` - ูุญุชูู ุนูู `handleApiError()` ููุนูู
- โ `lib/utils/api-helpers.ts` - ูุญุชูู ุนูู `successResponse()` ู `paginatedResponse()` ููุนููุงู

**ุงููููุงุช ุงูุชู ุชุณุชุฎุฏููุง ุจุงููุนู:**
- โ `app/api/orders/route.ts` - ูุณุชุฎุฏู `handleApiError()` ุจูุฌุงุญ
- โ `app/api/tasks/route.ts` - ูุณุชุฎุฏู `handleApiError()` ุจูุฌุงุญ
- โ `app/api/tasks/[id]/route.ts` - ูุณุชุฎุฏู `handleApiError()` ุจูุฌุงุญ

**ุงููุชูุฌุฉ:** ุงูู Functions ูุฌุฑุจุฉ ูุชุนูู ุจุดูู ุตุญูุญ!

---

### 2. **ููุณ ุงููุชูุฌุฉุ ุทุฑููุฉ ุฃูุถู**

**ูุจู (ููุฑุฑ):**
```typescript
catch (error) {
  console.error("Error fetching order:", error);
  return NextResponse.json(
    { success: false, error: "An error occurred while fetching the order" },
    { status: 500 }
  );
}
```

**ุจุนุฏ (ูุณุชุฎุฏู Utility Function):**
```typescript
catch (error) {
  return handleApiError(error);
}
```

**ุงููุชูุฌุฉ:** ููุณ ุงูู Response ุชูุงูุงูุ ููู:
- โ ุฃูู ููุฏ
- โ ุฃุณูู ูู ุงูุตูุงูุฉ
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฃูุถู (ูุฏุนู ZodError, ForbiddenError, Prisma errors, etc.)

---

### 3. **ูุง ุชุบููุฑ ูู ุงูุณููู (Behavior)**

**ูุซุงู: Success Response**

**ูุจู:**
```typescript
return NextResponse.json({
  success: true,
  data: order,
});
```

**ุจุนุฏ:**
```typescript
return successResponse(order);
```

**ุงููุชูุฌุฉ:** ููุณ ุงูู Response ุชูุงูุงู:
```json
{
  "success": true,
  "data": { ... }
}
```

---

## ๐ ุงูููุงุฑูุฉ

| ุงูุฌุงูุจ | ูุจู (ููุฑุฑ) | ุจุนุฏ (Utility Functions) |
|--------|------------|-------------------------|
| **ุงูุณููู** | โ ูุนูู | โ ูุนูู (ููุณ ุงูุดูุก) |
| **ุงููุชูุฌุฉ** | โ ููุณ ุงูู Response | โ ููุณ ุงูู Response |
| **ุนุฏุฏ ุงูุฃุณุทุฑ** | โ ุฃูุซุฑ | โ ุฃูู |
| **ุงูุตูุงูุฉ** | โ ุตุนุจ | โ ุณูู |
| **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก** | โ๏ธ ูุญุฏูุฏ | โ ุดุงูู |
| **ุงูุชูุญูุฏ** | โ ุบูุฑ ููุญุฏ | โ ููุญุฏ |

---

## ๐ ุฃูุซูุฉ ูู ุงููุดุฑูุน ุงูุญุงูู

### ูุซุงู 1: `app/api/orders/route.ts` (ูุณุชุฎุฏู handleApiError ุจุงููุนู)

```typescript
import { handleApiError } from "@/lib/error-handler";

export async function GET(request: NextRequest) {
  try {
    // ... logic
  } catch (error) {
    return handleApiError(error); // โ ูุนูู ุจุดูู ููุชุงุฒ
  }
}
```

**ุงููุชูุฌุฉ:** ูุนูู ุจุฏูู ุฃู ูุดุงูู!

---

### ูุซุงู 2: `app/api/tasks/route.ts` (ูุณุชุฎุฏู handleApiError ุจุงููุนู)

```typescript
import { handleApiError } from "@/lib/error-handler";

export async function GET(request: NextRequest) {
  try {
    // ... logic
  } catch (error) {
    return handleApiError(error); // โ ูุนูู ุจุดูู ููุชุงุฒ
  }
}
```

**ุงููุชูุฌุฉ:** ูุนูู ุจุฏูู ุฃู ูุดุงูู!

---

## โ๏ธ ุงูุญุงูุงุช ุงูุฎุงุตุฉ (Special Cases)

### 1. **Error Messages ุงููุฎุตุตุฉ**

ุฅุฐุง ูุงู ูุฏูู error message ูุฎุตุตุ ููููู ุงุณุชุฎุฏุงู `handleApiError()` ูุน custom error:

```typescript
// โ ูุจู
catch (error) {
  return NextResponse.json(
    { success: false, error: "Custom error message" },
    { status: 500 }
  );
}

// โ ุจุนุฏ
import { AppError } from '@/lib/error-handler';

catch (error) {
  throw new AppError("Custom error message", 500);
  // ุฃู
  return handleApiError(new AppError("Custom error message", 500));
}
```

---

### 2. **Response Headers ุงููุฎุตุตุฉ**

ุฅุฐุง ูุงู ูุฏูู custom headersุ ููููู ุฅุถุงูุชูุง:

```typescript
// โ ุจุนุฏ
const response = successResponse(data);
response.headers.set('X-Custom-Header', 'value');
return response;
```

---

## ๐งช ุฎุทุฉ ุงูุงุฎุชุจุงุฑ

ูุจู ุชุทุจูู ุงูุชุบููุฑุงุช ุนูู ุฌููุน ุงููููุงุชุ ูููููุง:

1. โ ุงุฎุชุจุงุฑ Utility Functions ุนูู ููู ูุงุญุฏ ุฃููุงู
2. โ ุงูุชุฃูุฏ ูู ุฃู ุงููุชูุฌุฉ ููุณูุง
3. โ ุซู ุชุทุจูููุง ุนูู ุจุงูู ุงููููุงุช

---

## ๐ ููุฎุต

| ุงูุณุคุงู | ุงูุฅุฌุงุจุฉ |
|--------|---------|
| **ูู ุณูุคุซุฑ ุนูู ุงููุดุฑูุนุ** | โ ูุงุ ูู ูุคุซุฑ ุณูุจูุงู |
| **ูู ุณูุชุบูุฑ ุงูุณูููุ** | โ ูุงุ ููุณ ุงูุณููู |
| **ูู ุณูุชุบูุฑ ุงูู Responseุ** | โ ูุงุ ููุณ ุงูู Response |
| **ูู ุณูููู ุฃูุถูุ** | โ ูุนูุ ุฃูุถู ุจูุซูุฑ |
| **ูู ุงูู Functions ุฌุงูุฒุฉุ** | โ ูุนูุ ููุฌูุฏุฉ ูุชุนูู |
| **ูู ููุงู ูููุงุช ุชุณุชุฎุฏููุงุ** | โ ูุนูุ ุนุฏุฉ ูููุงุช |

---

## ๐ ุงูููุงุฆุฏ

1. โ **ุชูููู Code Duplication ุจูุณุจุฉ ~40%**
2. โ **ุชุญุณูู Maintainability**
3. โ **ุชูุญูุฏ Error Handling**
4. โ **ุณูููุฉ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ**
5. โ **ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฃูุถู** (ูุฏุนู ุฃููุงุน ุฃุฎุทุงุก ุฃูุซุฑ)

---

## โ ุงูุฎูุงุตุฉ

**ุญุฐู ุงูุชูุฑุงุฑุงุช ุขูู ุชูุงูุงู ููู ูุคุซุฑ ุณูุจูุงู ุนูู ุงููุดุฑูุน!**

- โ ุงูู Utility Functions ููุฌูุฏุฉ ูุชุนูู
- โ ุจุนุถ ุงููููุงุช ุชุณุชุฎุฏููุง ุจุงููุนู ุจูุฌุงุญ
- โ ููุณ ุงููุชูุฌุฉุ ุทุฑููุฉ ุฃูุถู
- โ ูุง ุชุบููุฑ ูู ุงูุณููู

**ูููููุง ุงูุจุฏุก ุจุฃูุงู!** ๐

---

**ุชู ุฅุนุฏุงุฏ ุงูุชุญููู ุจูุงุณุทุฉ:** AI Assistant  
**ุงูุชุงุฑูุฎ:** ุฏูุณูุจุฑ 2024  
**ุงูุฅุตุฏุงุฑ:** 1.0.0

